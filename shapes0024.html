<!DOCTYPE html>
<html>
<head>
    <title>RNAFolding</title>
    <!-- needs styling pulled into css and classed used to set classes in script -->
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>
 
// set up window size
var width = window.innerWidth,
    height = window.innerHeight,

// set variables for proportional display
    smallDim = Math.min(width, height),
    radius = smallDim / 20,
    textHeight = radius * 1.5,
    sizeFactor = smallDim / 900,
// needs background and menus 
    menuHeight = radius * 2,
    menuWidth = radius * 12,


// ? separate data to 2nd file
// data and coords for 1-1 loop
    nullData11 = ["X", "X", "X", "X"],

    nullCoords11 = [
 //       cx    cy
        [-80, -300],
        [80,  -300],
        [-80,  300],
        [80,   300]
    ],

    activeData11 = ["A", "U", "R", "G", "C", "Y"], 

    activeCoords11 = [
 //       cx    cy
        [ -80, -140], // col 1         x  x
        [  80, -140], // col 2        c1  c2
        [-150,    0], // table 1    t1      t2
        [ 150,    0], // table 2      r1  r2
        [ -80,  140], // row 1         x  x
        [  80,  140]  // row 2
    ],

// data and coords for 2-2 loop
    nullData22 = ["X", "X", "X", "X"],

    nullCoords22 = [
 //       cx    cy
        [-80, -350],
        [ 80, -350],
        [-80,  350],
        [ 80,  350]
    ],

    activeData22 = ["A", "U", "R", "G", "C", "Y", "A", "N"], 

    activeCoords22 = [
 //       cx    cy
        [ -80, -190], // col 1
        [  80, -190], // col 2      x  x
        [-190,  -80], // row 1     c1  c2
        [ 190,  -80], // row 2   r1      r2
        [-190,   80], // row 3   r3      r4
        [ 190,   80], // row 4     c3  c4
        [ -80,  190], // col 3      x  x
        [  80,  190]  // col 4
    ], 

// data and coords for hairpin


    nullDataHP = ["X", "X"],

    nullCoordsHP = [
 //       cx    cy
        [-80, -220],
        [ 80, -220]
    ],

    activeDataHP = ["A", "U", "R", "G", "C", "Y"], 

    activeCoordsHP = [
 //       cx    cy
        [ -80, -60], // 1st nt          x  x
        [  80, -60], // 6th nt          1  6
        [-150,  80], // 2nd nt        2      5
        [ 150,  80], // 5th nt          3  4
        [ -80, 220], // 3rd nt
        [  80, 220]  // 4th nt
    ],

// data and coords for bulge -- needs bulge size menu of one to six nts -- 
// rough coords only -- needs exact coords --
    nullDataBG = ["X", "X", "X", "X", "X"],

    nullCoordsBG = [
 //       cx    cy
        [-80, -190],
        [ 80, -190],
        [135,   85], // ?use i = 3 to scroll # of nts
        [-80,  350],
        [ 80,  350]
    ],

    activeDataBG = ["A", "U", "R", "G",], 

    activeCoordsBG = [
 //       cx    cy                  
        [ -80,  -60], //col 1        x   x
        [  80,  -60], //col 2       c1  c2             
        [ -135,  85], //row 1      r1    x ? menu
        [    0, 190]  //row 2     x   r2
    ],                //             x

// data and coords for 1-2 loops 
// in progress -- not right -- needs exact coords --
    nullData12 = ["X", "X", "X", "X"],

    nullCoords12 = [
 //       cx    cy
        [-80, -350],
        [ 80, -350],
        [-80,  350],
        [ 80,  350]
    ],

    activeData12 = ["A", "U", "R", "G", "Y", "C", "N"], 

    activeCoords12 = [
 //       cx    cy
        [ -80,  -60],
        [  80,  -60],
        [ 135,   85],
        [   0, -190],
        [ 135,  -85],
        [-135,   85],
        [   0,  190]
    ],

    structMenuInit = ["Bulge"],

    structMenuItems = ["Bulge", "Hairpin", "1-1 Loop", "1-2 Loop", "2-2 Loop"],
 //                       x    y
    structMenuCoords = [-220,  0],

// select the html body, add svg element to body, add group element 
// to svg. circles and text are contained in the group element
    svg = d3.select("body")
    .append("svg")
        .attr("width", width)
        .attr("height", height)
    .append("g")
// move origin of group element to center of svg
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")"),

        // how did rect get outside body
        structMenu = svg.select(".stuctMenuRect")
        .data(structMenuInit);

    structMenu.enter()
        .append("rect")
        .attr("class", "stuctMenuRect")
        .attr("x", structMenuCoords[0])
        .attr("y", structMenuCoords[1])
        .attr("width", "menuWidth")
        .attr("height", "menuHeight")
        .style("fill", "blue");





// pass in array of nts, class text subpart, and 2D array of coords
// display nts as dots per coordinates
function update(displayData, displayClass, displayCoords)  {

// change to use structure with variable as key 
// lookup table for nt names and colors
    var nucleoArray = [
    //         nt              name        color
        {key: "A", values: ["Adenine",    "yellow"]}, 
        {key: "U", values: ["Uracil",     "blue"]}, 
        {key: "G", values: ["Guanine",    "red"]}, 
        {key: "C", values: ["Cytosine",   "green"]}, 
        {key: "R", values: ["puRine",     "orange"]}, 
        {key: "Y", values: ["pYrimidine", "turquoise"]}, 
        {key: "N", values: ["unkNown",    "silver"]},
        {key: "X", values: ["X null",     "pink"]}
    ];
  
    // draw a dot for each value in displayData per coords in displayData
    // select all circles of current display class
    var circles = svg.selectAll("." + displayClass + "Circle")
        .data(displayData); // join displayData to selected circles

    circles.enter() // create an enter subsection
        .append("circle") // add circles as needed
        .attr("class", displayClass + "Circle") // set class so selectAll can find circles
        // add ids by index so single dots can be selected
        .attr("id", function(d, i) {return displayClass + "Circle" + i;})// id
        .attr("r", radius)
        .attr("cx", function(d, i) {return displayCoords[i][0] * sizeFactor})
        .attr("cy", function(d, i) {return displayCoords[i][1] * sizeFactor})
        .attr("fill", function(d, i) {
            var j = 0;
            for (j = 0; j < nucleoArray.length; j++) {
                if(nucleoArray[j].key == d) {
                    return nucleoArray[j].values[1];
                };
            };
            
        });

    circles.exit().remove(); // delete any leftover elements
    
    if (displayClass == "active") { // only allow active nts to respond to mouse
        // add gray outline on mouseover
        circles.on("mouseover", function(){d3.select(this)
            .style("stroke", "gray")
            .style("stroke-width", 4);})
        // remove gray outline when not mouseover
        .on("mouseout", function(){d3.select(this)
            .style("stroke", "gray")
            .style("stroke-width", 0);});};
        // click to scroll through options
<<<<<<< Updated upstream
        // ? add lines directly to dots or like text below

// text on circles takes mouseover focus away from circle
// needs fix  -- text mouseovers demonstrate this


    var text = svg.selectAll("." + displayClass + "Text") // select current potential text of displayClass
        .data(displayData);  // join displayData to selected text

    text.enter() 
        .append("text") // add empty text elements
        .attr("class", displayClass + "Text")// set class so selectAll can find text elements
        .text(function(d) {return d}) // add text from
        .attr("x", function(d, i) {return displayCoords[i][0] * sizeFactor}) // position
        .attr("y", function(d, i) {return displayCoords[i][1] * sizeFactor + textHeight / 2.8})
        .attr("text-anchor", "middle")
        .style("font-size", textHeight + "px"); // size 

    text.exit().remove(); // delete any leftover elements

// shows how text takes focus of mouseover from dots
    if (displayClass == "active") {  // only allow active nts to respond to mouse
        // add gray outline on mouseover
        text.on("mouseover", function(){d3.select(this)
            .style("stroke", "gray")
            .style("stroke-width", 4);})
        // remove gray outline when not mouseover
        .on("mouseout", function(){d3.select(this)
            .style("stroke", "gray")
            .style("stroke-width", 0);})
        // on click
        .on("click", function(d, i) {
            var j = 0,
                clickedText = d3.select(this); //select text that user clicked
            // cycle thru nucleoArray by j, match key to d and get new key and fill value
            for (j = 0; j < nucleoArray.length; j++) {
                if (nucleoArray[j].key == d) {
                    var newKey = nucleoArray[(j + 1) % (nucleoArray.length - 1)].key;
                    var newFill = nucleoArray[(j + 1) % (nucleoArray.length - 1)].values[1];
                    clickedText.data(newKey) // update data to new key
                        .text(newKey);  // update text to new key
                    displayData[i] = newKey;  // update displayData to new key
                    d3.select("#" + displayClass + "Circle" + i) //select circle behind clickedText
                        .style("fill", newFill);  // and update to new fill
                };
            };
        });
    };

    //needs a done button to submit array
    return displayData;

}
// active data returned from update needs to generate search for lowest energy matching sequence
// comment out all but one pair

//update(nullData11, "null", nullCoords11);      // draws null NTs above and below 1-1 loop
//activeData11 = update(activeData11, "active", activeCoords11);// draws circle of 6 NTs for 1-1 loop

update(nullData22, "null", nullCoords22);      // draws null NTs above and below 2-2 loop
activeData22 = update(activeData22, "active", activeCoords22);// draws circle of 8 NTs for 2-2 loop   

//update(nullDataHP, "null", nullCoordsHP);      // draws null NTs above hairpin
//activeDataHP = update(activeDataHP, "active", activeCoordsHP);// draws circle of 6 NTs for hairpin

//update(nullDataBG, "null", nullCoordsBG);// draws null NTs above and SW of bulge and 1 in circle
//activeDataBG = update(activeDataBG, "active", activeCoordsBG);// draws 4 NTs in circle of 5 NTs for bulge
=======
        .on("click", function(){d3.select(this)
            ;})
    }
>>>>>>> Stashed changes

// ----working but bad coords ---- 
//update(nullData12, "null", nullCoords12);// draws null NTs above and SW of 1-2 loop
//activeData12 = update(activeData12, "active", activeCoords12);// draws 7 NTs in circle for 1-2 loop

</script>
</body>
</html>